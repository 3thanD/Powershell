# 1. DEFINE THE ACCOUNT YOU ARE SEARCHING FOR
# --- !!! CHANGE THIS VALUE !!! ---
$targetUser = "domain\accountnamehere"
 
# 2. GET THE LIST OF SERVERS TO CHECK
#    (Choose one of these options)
# --- Option A: From a simple text file ---
#    (Create a file at C:\temp\servers.txt with one server name per line)
try {
   $servers = Get-Content -Path "C:\temp\servers.txt" -ErrorAction Stop
} catch {
   Write-Host "Could not find C:\temp\servers.txt. Please create it or use Option B." -ForegroundColor Red
   return
}
# --- Option B: From Active Directory ---
#    (This requires the Active Directory module for PowerShell)
# Import-Module ActiveDirectory
# $servers = Get-ADComputer -Filter 'OperatingSystem -like "*Server*" -and Enabled -eq $true' | Select-Object -ExpandProperty Name
 
# 3. RUN THE QUERY
Write-Host "Checking $($servers.Count) servers for services running as '$targetUser'..." -ForegroundColor Cyan
# We use Get-CimInstance as it's the modern standard.
# It will query all servers in parallel.
$results = Get-CimInstance -ClassName Win32_Service -ComputerName $servers -ErrorAction SilentlyContinue | Where-Object { $_.StartName -eq $targetUser }
 
# 4. DISPLAY THE RESULTS
if ($results) {
   Write-Host "--- DANGEROUS SERVICES FOUND ---" -ForegroundColor Red
   Write-Host "The following services are running as '$targetUser'. This is a major security risk."
   # Format the output for a clean view
   $results | Select-Object @{Name="Server";Expression={$_.PSComputerName}},
                          @{Name="Service Name";Expression={$_.Name}},
                          @{Name="Display Name";Expression={$_.DisplayName}},
                          @{Name="LogOnAs";Expression={$_.StartName}} | Format-Table
} else {
   Write-Host "--- NO SERVICES FOUND ---" -ForegroundColor Green
   Write-Host "No services were found running as '$targetUser' on the reachable servers."
